{% extends "base.html" %}

{% block title %}Members - Digital Club{% endblock %}

{% block content %}
<section style="padding: 5rem 0;">
    <div class="container">
        <h1 style="text-align: center; font-size: 3rem; margin-bottom: 3rem; color: var(--primary-color);" data-aos="fade-up">
            Our Members
        </h1>
        
        <!-- Filters -->
        <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 3rem; flex-wrap: wrap;" data-aos="fade-up">
            <form method="GET" style="display: flex; gap: 1rem; align-items: center;">
                <select name="status" class="form-control" style="width: auto;">
                    <option value="">All Members</option>
                    <option value="student" {% if request.args.get('status') == 'student' %}selected{% endif %}>Students</option>
                    <option value="alumni" {% if request.args.get('status') == 'alumni' %}selected{% endif %}>Alumni</option>
                </select>
                
                <select name="course" class="form-control" style="width: auto;">
                    <option value="">All Courses</option>
                    {% for course in courses %}
                    <option value="{{ course }}" {% if request.args.get('course') == course %}selected{% endif %}>{{ course }}</option>
                    {% endfor %}
                </select>
                
                <select name="year" class="form-control" style="width: auto;">
                    <option value="">All Years</option>
                    {% for year in years %}
                    <option value="{{ year }}" {% if request.args.get('year') == year %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
                
                <button type="submit" class="btn-primary">
                    <i class="fas fa-filter"></i> Filter
                </button>
                
                {% if request.args.get('course') or request.args.get('year') or request.args.get('status') %}
                <a href="{{ url_for('main.members') }}" class="btn-secondary">
                    <i class="fas fa-times"></i> Clear
                </a>
                {% endif %}
            </form>
        </div>
        
        {% if members and members.items %}
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem;">
            {% for member in members.items %}
            <div class="card" data-aos="fade-up" data-aos-delay="{{ loop.index * 50 }}">
                <div style="text-align: center;">
                    {% if member.profile_image %}
                    <img src="{{ url_for('static', filename='uploads/profiles/' + member.profile_image) }}" 
                         alt="{{ member.full_name }}" 
                         style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem; border: 2px solid var(--primary-color);">
                    {% else %}
                    <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user" style="font-size: 2.5rem; color: var(--bg-primary);"></i>
                    </div>
                    {% endif %}
                    
                    <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">{{ member.full_name }}</h3>
                    
                    {% if member.title %}
                    <p style="color: var(--primary-color); font-weight: 600; margin-bottom: 0.5rem;">{{ member.title }}</p>
                    {% endif %}
                    
                    <div style="margin-bottom: 1rem;">
                        {% if member.course %}
                        <span style="background: rgba(0, 255, 255, 0.1); color: var(--primary-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; margin-right: 0.5rem;">
                            {{ member.course }}
                        </span>
                        {% endif %}
                        {% if member.year %}
                        <span style="background: rgba(255, 0, 255, 0.1); color: var(--secondary-color); padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">
                            {{ member.year }}
                        </span>
                        {% endif %}
                    </div>
                    
                    {% if member.areas_of_interest %}
                    <div style="margin-bottom: 1rem;">
                        {% for area in member.get_areas_list()[:3] %}
                        <span style="background: rgba(255, 255, 0, 0.1); color: var(--accent-color); padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.7rem; margin-right: 0.3rem; margin-bottom: 0.3rem; display: inline-block;">
                            {{ area }}
                        </span>
                        {% endfor %}
                        {% if member.get_areas_list()|length > 3 %}
                        <span style="background: rgba(255, 255, 0, 0.1); color: var(--accent-color); padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.7rem; margin-right: 0.3rem; margin-bottom: 0.3rem; display: inline-block;">
                            +{{ member.get_areas_list()|length - 3 }} more
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Always show achievements section if member has trophies or points -->
                    {% if member.trophies or member.get_total_points() > 0 %}
                    <div style="background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(255, 0, 255, 0.1) 100%); border: 1px solid rgba(0, 255, 255, 0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1rem;">
                        <!-- Points Display -->
                        {% if member.get_total_points() > 0 %}
                        <div style="text-align: center; margin-bottom: 0.8rem;">
                            <div style="font-size: 2rem; font-weight: 700; color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); margin-bottom: 0.2rem;">
                                {{ member.get_total_points() }}
                            </div>
                            <div style="font-size: 0.9rem; color: white; font-weight: 600; letter-spacing: 1px;">
                                POINTS
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Trophies Display - Always show if member has trophies -->
                        {% if member.trophies %}
                        <div style="{% if member.get_total_points() > 0 %}border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 0.8rem;{% endif %}">
                            <div style="text-align: center; color: white; font-weight: 600; font-size: 0.85rem; margin-bottom: 0.6rem; letter-spacing: 1px;">
                                üèÜ TROPHIES EARNED
                            </div>
                            <div style="display: flex; gap: 0.8rem; justify-content: center; flex-wrap: wrap;">
                                {% for trophy in member.trophies[:3] %}
                                <div style="text-align: center; min-width: 70px;">
                                    <div style="font-size: 2rem; margin-bottom: 0.3rem; filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));">
                                        {% if trophy.icon.startswith('fa') %}
                                        <i class="{{ trophy.icon }}"></i>
                                        {% else %}
                                        {{ trophy.icon }}
                                        {% endif %}
                                    </div>
                                    <div style="color: white; font-size: 0.7rem; font-weight: 600; line-height: 1.2;">
                                        {{ trophy.name }}
                                    </div>
                                </div>
                                {% endfor %}
                                {% if member.trophies|length > 3 %}
                                <div style="text-align: center; min-width: 70px; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(255, 215, 0, 0.2); border: 2px dashed rgba(255, 215, 0, 0.5); border-radius: 8px; padding: 0.8rem 0.6rem; color: #FFD700; font-weight: 700; font-size: 0.9rem;">
                                        +{{ member.trophies|length - 3 }}<br>more
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- View More Button -->
                    <div style="margin-top: 1rem;">
                        <a href="{{ url_for('main.member_public_profile', member_id=member.id) }}" 
                           class="btn-primary" 
                           style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.8rem 1.5rem; border-radius: 25px; text-decoration: none; transition: all 0.3s ease;">
                            <i class="fas fa-eye"></i>
                            View More
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if members.pages > 1 %}
        <div style="display: flex; justify-content: center; margin-top: 3rem;">
            <div style="display: flex; gap: 0.5rem; align-items: center;">
                {% if members.has_prev %}
                <a href="{{ url_for('main.members', page=members.prev_num, course=request.args.get('course'), year=request.args.get('year')) }}" 
                   class="btn-secondary">
                    <i class="fas fa-chevron-left"></i>
                </a>
                {% endif %}
                
                {% for page_num in members.iter_pages() %}
                    {% if page_num %}
                        {% if page_num != members.page %}
                        <a href="{{ url_for('main.members', page=page_num, course=request.args.get('course'), year=request.args.get('year')) }}" 
                           class="btn-secondary">{{ page_num }}</a>
                        {% else %}
                        <span class="btn-primary">{{ page_num }}</span>
                        {% endif %}
                    {% else %}
                    <span style="color: var(--text-muted);">...</span>
                    {% endif %}
                {% endfor %}
                
                {% if members.has_next %}
                <a href="{{ url_for('main.members', page=members.next_num, course=request.args.get('course'), year=request.args.get('year')) }}" 
                   class="btn-secondary">
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        {% else %}
        <div style="text-align: center; padding: 3rem;">
            <i class="fas fa-users" style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--text-secondary); margin-bottom: 1rem;">No Members Found</h3>
            <p style="color: var(--text-muted);">Try adjusting your filters or check back later.</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
