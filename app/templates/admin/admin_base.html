{% extends "baseAdmin.html" %}

{% block title %}{% block admin_title %}Admin Panel{% endblock %} - Digital Club{% endblock %}

{% block extra_head %}{% endblock %}

{% block content %}
<div class="admin-layout">
    <!-- Admin Sidebar -->
    <div class="admin-sidebar" id="adminSidebar">
        <div class="admin-sidebar-header">
            <a href="{{ url_for('main.index') }}" class="admin-logo" aria-label="Digital Club Home">
                <img src="{{ url_for('static', filename='DigitalClub_LOGO copy.svg') }}" alt="Digital Club Logo">
                <div class="admin-logo-text">
                    <span>Digital Club</span>
                    <small>Admin</small>
                </div>
            </a>
            <button class="admin-sidebar-toggle" id="sidebarToggle" type="button" aria-label="Toggle sidebar">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <div class="admin-sidebar-actions">
            <a href="{{ url_for('main.index') }}" class="admin-home-link" title="Back to site">
                <i class="fas fa-arrow-left"></i>
                <span>Back to Home</span>
            </a>
            <button class="theme-toggle admin-theme-toggle" id="theme-toggle" type="button" aria-pressed="false" aria-label="Toggle color theme">
                <i class="fas fa-sun" aria-hidden="true"></i>
                <span class="theme-label">Light</span>
            </button>
        </div>
        
        <nav class="admin-sidebar-nav">
            <!-- Dashboard -->
            <a href="{{ url_for('admin.dashboard') }}" class="admin-nav-item {% if request.endpoint == 'admin.dashboard' %}active{% endif %}">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            
            <!-- Members & Users -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="members-users">
                    <i class="fas fa-users"></i>
                    <span>Members</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-members-users">
                    <a href="{{ url_for('admin.users') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint == 'admin.users' %}active{% endif %}">
                        <i class="fas fa-users-cog"></i>
                        <span>Users</span>
                    </a>
                    <a href="{{ url_for('admin.members') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.members', 'admin.member_detail'] %}active{% endif %}">
                        <i class="fas fa-id-card"></i>
                        <span>Members</span>
                    </a>
                    <a href="{{ url_for('admin.scan_id') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint == 'admin.scan_id' %}active{% endif %}">
                        <i class="fas fa-qrcode"></i>
                        <span>Scan ID</span>
                    </a>
                </div>
            </div>
            
            <!-- Financial -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="financial">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Finance</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-financial">
                    <a href="{{ url_for('admin.payments') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.payments', 'admin.add_payment', 'admin.edit_payment'] %}active{% endif %}">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Payments</span>
                    </a>
                    <a href="{{ url_for('admin.financial') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.financial', 'admin.create_financial_period', 'admin.financial_period_detail', 'admin.add_transaction', 'admin.edit_transaction', 'admin.financial_categories', 'admin.add_financial_category', 'admin.edit_financial_category', 'admin.financial_reports', 'admin.export_financial_period'] %}active{% endif %}">
                        <i class="fas fa-chart-line"></i>
                        <span>Management</span>
                    </a>
                </div>
            </div>
            
            <!-- Rewards & Recognition -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="rewards">
                    <i class="fas fa-award"></i>
                    <span>Rewards</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-rewards">
                    <a href="{{ url_for('admin.rewards_history') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.rewards_history', 'admin.add_points'] %}active{% endif %}">
                        <i class="fas fa-coins"></i>
                    <span>Points</span>
                    </a>
                    <a href="{{ url_for('admin.trophies') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.trophies', 'admin.add_trophy', 'admin.edit_trophy'] %}active{% endif %}">
                        <i class="fas fa-trophy"></i>
                        <span>Trophies</span>
                    </a>
                </div>
            </div>
            
            <!-- Content Management -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="content">
                    <i class="fas fa-file-alt"></i>
                    <span>Content</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-content">
                    <a href="{{ url_for('admin.news') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.news', 'admin.add_news', 'admin.edit_news'] %}active{% endif %}">
                        <i class="fas fa-newspaper"></i>
                        <span>News</span>
                    </a>
                    <a href="{{ url_for('admin.blogs') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.blogs', 'admin.add_blog', 'admin.edit_blog'] %}active{% endif %}">
                        <i class="fas fa-blog"></i>
                        <span>Blogs</span>
                    </a>
                    <a href="{{ url_for('admin.leaders') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.leaders', 'admin.add_leader', 'admin.edit_leader'] %}active{% endif %}">
                        <i class="fas fa-crown"></i>
                        <span>Leaders</span>
                    </a>
                    <a href="{{ url_for('admin.gallery') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.gallery', 'admin.add_gallery_item', 'admin.edit_gallery_item'] %}active{% endif %}">
                        <i class="fas fa-images"></i>
                        <span>Gallery</span>
                    </a>
                </div>
            </div>
            
            <!-- Events -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Events</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-events">
                    <a href="{{ url_for('admin.events') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.events', 'admin.add_event', 'admin.edit_event'] %}active{% endif %}">
                        <i class="fas fa-calendar"></i>
                        <span>Manage Events</span>
                    </a>
                    <a href="{{ url_for('admin.rsvps') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.rsvps', 'admin.approve_rsvp', 'admin.reject_rsvp', 'admin.bulk_approve_rsvps', 'admin.bulk_reject_rsvps'] %}active{% endif %}">
                        <i class="fas fa-calendar-check"></i>
                        <span>RSVPs</span>
                    </a>
                </div>
            </div>

            <!-- Sessions -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="sessions">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span>Sessions</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-sessions">
                    <a href="{{ url_for('admin.sessions_index') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.sessions_index', 'admin.sessions_week_add', 'admin.sessions_week_view', 'admin.sessions_session_add', 'admin.sessions_session_edit'] %}active{% endif %}">
                        <i class="fas fa-calendar-week"></i>
                        <span>Weekly Timetable</span>
                    </a>
                    <a href="{{ url_for('admin.sessions_reports') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.sessions_reports'] %}active{% endif %}">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Instructor Reports</span>
                    </a>
                </div>
            </div>

            <!-- Competitions -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="competitions">
                    <i class="fas fa-trophy"></i>
                    <span>Competitions</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-competitions">
                    <a href="{{ url_for('admin.competitions') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.competitions', 'admin.competitions_view', 'admin.competitions_add', 'admin.competitions_edit', 'admin.competitions_submissions'] %}active{% endif %}">
                        <i class="fas fa-trophy"></i>
                        <span>All Competitions</span>
                    </a>
                    <a href="{{ url_for('admin.competitions_weekly') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint == 'admin.competitions_weekly' %}active{% endif %}">
                        <i class="fas fa-calendar-week"></i>
                        <span>Weekly</span>
                    </a>
                    <a href="{{ url_for('admin.competitions_monthly') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint == 'admin.competitions_monthly' %}active{% endif %}">
                        <i class="fas fa-calendar"></i>
                        <span>Monthly</span>
                    </a>
                </div>
            </div>
            
            <!-- Projects & Technology -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="projects">
                    <i class="fas fa-laptop-code"></i>
                    <span>Projects</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-projects">
                    <a href="{{ url_for('admin.projects') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.projects', 'admin.add_project', 'admin.edit_project'] %}active{% endif %}">
                        <i class="fas fa-project-diagram"></i>
                        <span>Projects</span>
                    </a>
                    <a href="{{ url_for('admin.technologies') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint in ['admin.technologies', 'admin.add_technology', 'admin.edit_technology'] %}active{% endif %}">
                        <i class="fas fa-code"></i>
                        <span>Technologies</span>
                    </a>
                </div>
            </div>

            <!-- Teams -->
            <a href="{{ url_for('admin.teams_index') }}" class="admin-nav-item {% if request.endpoint in ['admin.teams_index', 'admin.teams_view'] %}active{% endif %}">
                <i class="fas fa-people-group"></i>
                <span>Teams</span>
            </a>
            
            <!-- Communication -->
            <div class="admin-nav-dropdown">
                <a href="#" class="admin-nav-item admin-nav-dropdown-toggle" data-dropdown="communication">
                    <i class="fas fa-comments"></i>
                    <span>Comms</span>
                    <i class="fas fa-chevron-down admin-dropdown-icon"></i>
                </a>
                <div class="admin-nav-dropdown-menu" id="dropdown-communication">
                    <a href="{{ url_for('admin.newsletter') }}" class="admin-nav-item admin-nav-subitem {% if request.endpoint == 'admin.newsletter' %}active{% endif %}">
                        <i class="fas fa-envelope"></i>
                        <span>Newsletter</span>
                    </a>
                </div>
            </div>
            
            <!-- Settings -->
            <a href="{{ url_for('admin.settings') }}" class="admin-nav-item {% if request.endpoint == 'admin.settings' %}active{% endif %}">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>
    
    <!-- Admin Main Content -->
    <div class="admin-main" id="adminMain">
        <!-- Admin Header -->
        <div class="admin-header">
            <div class="admin-header-content">
                <div class="admin-header-left">
                    <div>
                        <h1 class="admin-page-title">{% block page_title %}Dashboard{% endblock %}</h1>
                        <nav class="admin-breadcrumb">
                            <a href="{{ url_for('admin.dashboard') }}">Admin</a>
                            {% block breadcrumb %}{% endblock %}
                        </nav>
                    </div>
                </div>
                
                <div class="admin-header-right">
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i> {{ current_user.email }}
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('admin.admin_profile') }}">
                                <i class="fas fa-user"></i> My Profile
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.index') }}">
                                <i class="fas fa-home"></i> View Site
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Content -->
        <div class="admin-content">
            {% block admin_content %}{% endblock %}
        </div>
    </div>
</div>

<script>
// Sidebar toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('adminSidebar');
    const main = document.getElementById('adminMain');
    const toggle = document.getElementById('sidebarToggle');
    const dropdownToggles = document.querySelectorAll('.admin-nav-dropdown-toggle');
    
    // Check for saved sidebar state
    const sidebarCollapsed = localStorage.getItem('adminSidebarCollapsed') === 'true';
    if (sidebarCollapsed) {
        sidebar.classList.add('collapsed');
        main.classList.add('sidebar-collapsed');
    }
    
    toggle.addEventListener('click', function() {
        sidebar.classList.toggle('collapsed');
        main.classList.toggle('sidebar-collapsed');
        
        // Save state
        localStorage.setItem('adminSidebarCollapsed', sidebar.classList.contains('collapsed'));
    });
    
    // Mobile sidebar toggle
    if (window.innerWidth <= 768) {
        sidebar.classList.add('collapsed');
        main.classList.add('sidebar-collapsed');
    }
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth <= 768) {
            sidebar.classList.add('collapsed');
            main.classList.add('sidebar-collapsed');
        } else {
            // Restore saved state on desktop
            const savedState = localStorage.getItem('adminSidebarCollapsed') === 'true';
            if (savedState) {
                sidebar.classList.add('collapsed');
                main.classList.add('sidebar-collapsed');
            } else {
                sidebar.classList.remove('collapsed');
                main.classList.remove('sidebar-collapsed');
            }
        }
    });
    
    function setDropdownHeight(menu, open) {
        if (!menu) return;
        if (open) {
            const height = menu.scrollHeight;
            menu.style.maxHeight = `${height}px`;
        } else {
            menu.style.maxHeight = '0px';
        }
    }
    
    dropdownToggles.forEach(toggle => {
        toggle.addEventListener('click', function(e) {
            e.preventDefault();
            
            const dropdown = this.closest('.admin-nav-dropdown');
            const dropdownId = this.getAttribute('data-dropdown');
            const isCurrentlyOpen = dropdown.classList.contains('open');
            
            // Close all dropdowns
            document.querySelectorAll('.admin-nav-dropdown').forEach(d => {
                d.classList.remove('open');
                const t = d.querySelector('.admin-nav-dropdown-toggle');
                if (t) {
                    const id = t.getAttribute('data-dropdown');
                    localStorage.setItem('adminDropdown-' + id, 'false');
                }
                setDropdownHeight(d.querySelector('.admin-nav-dropdown-menu'), false);
            });
            
            // If the clicked dropdown was closed, open it
            if (!isCurrentlyOpen) {
                dropdown.classList.add('open');
                localStorage.setItem('adminDropdown-' + dropdownId, 'true');
                setDropdownHeight(dropdown.querySelector('.admin-nav-dropdown-menu'), true);
            }
        });
    });
    
    // Restore dropdown states from localStorage
    function restoreDropdownStates() {
        dropdownToggles.forEach(toggle => {
            const dropdown = toggle.closest('.admin-nav-dropdown');
            const dropdownId = toggle.getAttribute('data-dropdown');
            const savedState = localStorage.getItem('adminDropdown-' + dropdownId);
            
            if (savedState === 'true') {
                dropdown.classList.add('open');
                setDropdownHeight(dropdown.querySelector('.admin-nav-dropdown-menu'), true);
            }
        });
    }
    
    // Auto-expand dropdown if child item is active
    function autoExpandActiveDropdowns() {
        const activeSubitems = document.querySelectorAll('.admin-nav-subitem.active');
        
        activeSubitems.forEach(subitem => {
            const dropdown = subitem.closest('.admin-nav-dropdown');
            if (dropdown) {
                dropdown.classList.add('open');
                setDropdownHeight(dropdown.querySelector('.admin-nav-dropdown-menu'), true);
                
                // Save the auto-expanded state
                const toggle = dropdown.querySelector('.admin-nav-dropdown-toggle');
                if (toggle) {
                    const dropdownId = toggle.getAttribute('data-dropdown');
                    localStorage.setItem('adminDropdown-' + dropdownId, 'true');
                }
            }
        });
    }
    
    // Initialize dropdown states
    restoreDropdownStates();
    autoExpandActiveDropdowns();
});
</script>
{% endblock %}
