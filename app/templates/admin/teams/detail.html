{% extends "admin/admin_base.html" %}

{% block admin_title %}Team{% endblock %}
{% block page_title %}{{ team.name }}{% endblock %}
{% block breadcrumb %}<span class="breadcrumb-separator">/</span> <a href="{{ url_for('admin.teams_index') }}">Teams</a><span class="breadcrumb-separator">/</span> <span>{{ team.name }}</span>{% endblock %}

{% block admin_content %}
<div class="admin-card mb-3">
    <div class="admin-card-body">
        <form method="POST">
            <div class="row g-3">
                <div class="col-md-8">
                    <label class="admin-form-label">Description</label>
                    <textarea name="description" class="admin-form-control" rows="3">{{ team.description or '' }}</textarea>
                </div>
                <div class="col-md-4">
                    <label class="admin-form-label">Rating (0-5)</label>
                    <input type="number" name="rating" class="admin-form-control" min="0" max="5" value="{{ team.rating }}">
                </div>
            </div>
            <div class="mt-3">
                <button type="submit" class="admin-btn admin-btn-primary">Save Team</button>
            </div>
        </form>
    </div>
</div>

<div class="admin-card mb-3">
    <div class="admin-card-header">
        <h5>Add Member</h5>
    </div>
    <div class="admin-card-body">
        <form method="POST" action="{{ url_for('admin.teams_assign_member', team_id=team.id) }}" class="row g-2 align-items-end">
            <div class="col-md-8">
                <label class="admin-form-label">Member</label>
                <select name="member_id" class="admin-form-select" required>
                    <option value="">Select member</option>
                    {% for m in members %}
                    <option value="{{ m.id }}">{{ m.full_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="admin-form-label">Leader</label>
                <input type="checkbox" name="is_leader" class="form-check-input">
            </div>
            <div class="col-md-2">
                <button type="submit" class="admin-btn admin-btn-outline w-100">Assign</button>
            </div>
        </form>
    </div>
</div>

<div class="admin-card">
    <div class="admin-card-header">
        <h5>Team Members</h5>
    </div>
    <div class="admin-card-body">
        <div class="admin-table-responsive">
            <table class="table admin-table">
                <thead>
                    <tr>
                        <th>Member</th>
                        <th>Role</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for tm in team_members %}
                    <tr>
                        <td>{{ tm.member.full_name }}</td>
                        <td>{{ 'Leader' if tm.is_leader else 'Member' }}</td>
                        <td class="text-end">
                            {% if not tm.is_leader %}
                            <form method="POST" action="{{ url_for('admin.teams_set_leader', team_id=team.id, team_member_id=tm.id) }}" class="d-inline">
                                <button type="submit" class="admin-btn admin-btn-outline admin-btn-sm">Make Leader</button>
                            </form>
                            {% endif %}
                            <form method="POST" action="{{ url_for('admin.teams_remove_member', team_id=team.id, team_member_id=tm.id) }}" class="d-inline">
                                <button type="submit" class="admin-btn admin-btn-outline admin-btn-sm">Remove</button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="3" class="text-center">No members assigned yet.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
