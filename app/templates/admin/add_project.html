{% extends "admin/admin_base.html" %}

{% block admin_title %}Add Project{% endblock %}
{% block page_title %}Add Project{% endblock %}
{% block breadcrumb %}<span class="breadcrumb-separator">/</span> <a href="{{ url_for('admin.projects') }}">Projects Management</a><span class="breadcrumb-separator">/</span> <span>Add Project</span>{% endblock %}

{% block admin_content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="admin-form">
            <div class="d-flex align-items-center mb-4">
                <div class="admin-activity-icon primary me-3">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <div>
                    <h2 class="mb-1">Add Project</h2>
                    <p class="mb-0">Create a new project showcase</p>
                </div>
            </div>
            
            <form method="POST">
                <div class="admin-form-group">
                    <label for="title" class="admin-form-label">Project Title</label>
                    <input type="text" class="admin-form-control" id="title" name="title" required 
                           placeholder="Enter the project title">
                </div>
                
                <div class="admin-form-group">
                    <label for="description" class="admin-form-label">Project Description</label>
                    <textarea class="admin-form-control" id="description" name="description" rows="5" 
                              placeholder="Describe the project, its purpose, and key features"></textarea>
                </div>
                
                <div class="admin-form-group">
                    <label for="image" class="admin-form-label">Project Image URL</label>
                    <input type="url" class="admin-form-control" id="image" name="image" 
                           placeholder="https://example.com/project-image.jpg">
                    <small class="form-text">Optional: URL to project screenshot or logo</small>
                </div>
                
                <div class="admin-form-group">
                    <label for="technologies" class="admin-form-label">Technologies Used</label>
                    
                    <!-- Technology Selection -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="admin-form-label">Select from predefined technologies:</label>
                            <select class="admin-form-control" id="tech-select" multiple size="8">
                                {% for tech in technologies %}
                                <option value="{{ tech.name }}" data-category="{{ tech.category }}">
                                    {% if tech.icon %}<i class="{{ tech.icon }}"></i> {% endif %}{{ tech.name }} ({{ tech.category|title }})
                                </option>
                                {% endfor %}
                            </select>
                            <small class="form-text">Hold Ctrl/Cmd to select multiple technologies</small>
                        </div>
                        <div class="col-md-6">
                            <label class="admin-form-label">Selected Technologies:</label>
                            <div id="selected-techs" class="border rounded p-2" style="min-height: 200px; background: rgba(0,0,0,0.3);">
                                <small >No technologies selected</small>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSelectedTechs()">
                                    <i class="fas fa-plus"></i> Add Selected
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearSelectedTechs()">
                                    <i class="fas fa-trash"></i> Clear All
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Technology Input -->
                    <input type="text" class="admin-form-control" id="technologies" name="technologies" 
                           placeholder="e.g., Python, Flask, JavaScript, React (comma-separated)">
                    <small class="form-text">
                        <strong>Tips:</strong> You can select from predefined technologies above or type custom ones separated by commas.
                        <br>• Web: HTML, CSS, JavaScript, React, Node.js, Express
                        <br>• Mobile: React Native, Flutter, Swift, Kotlin
                        <br>• AI/ML: Python, TensorFlow, PyTorch, Scikit-learn
                        <br>• IoT: Arduino, Raspberry Pi, ESP32, Sensors
                        <br>• Data: Python, R, SQL, Pandas, Matplotlib
                    </small>
                </div>
                
                <div class="admin-form-group">
                    <label for="team_members" class="admin-form-label">Team Members</label>
                    <select class="admin-form-control" id="team_members" name="team_members" multiple size="5">
                        {% for member in members %}
                        <option value="{{ member.full_name }}">
                            {{ member.full_name }} - {{ member.user.email }}
                            {% if member.title %} ({{ member.title }}){% endif %}
                            {% if member.course %} - {{ member.course }}{% endif %}
                        </option>
                        {% endfor %}
                    </select>
                    <small class="form-text">Hold Ctrl/Cmd to select multiple members</small>
                    <div id="selected-count" class="text-info small mt-1" style="display: none;">
                        <i class="fas fa-users"></i> <span id="count-text">0</span> members selected
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured">
                            <label class="form-check-label" for="is_featured">
                                Feature this project on the homepage
                            </label>
                        </div>
                        <div class="form-text">Featured projects will be displayed prominently on the main projects page</div>
                    </div>
                    {% if not members %}
                    <small >No approved members found. Members must be approved before they can be added to projects.</small>
                    {% endif %}
                </div>
                
                <div class="admin-form-group">
                    <label for="github_link" class="admin-form-label">GitHub Link</label>
                    <input type="url" class="admin-form-control" id="github_link" name="github_link" 
                           placeholder="https://github.com/username/project-name">
                </div>
                
                <div class="admin-form-group">
                    <label for="demo_link" class="admin-form-label">Demo Link</label>
                    <input type="url" class="admin-form-control" id="demo_link" name="demo_link" 
                           placeholder="https://your-project-demo.com">
                </div>
                
                <div class="d-flex gap-3">
                    <button type="submit" class="admin-btn admin-btn-primary">
                        <i class="fas fa-save"></i> Save Project
                    </button>
                    <a href="{{ url_for('admin.projects') }}" class="admin-btn admin-btn-outline">
                        <i class="fas fa-arrow-left"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Technology selection functionality
let selectedTechnologies = [];

function addSelectedTechs() {
    const techSelect = document.getElementById('tech-select');
    const selectedOptions = Array.from(techSelect.selectedOptions);
    
    selectedOptions.forEach(option => {
        const techName = option.value;
        if (!selectedTechnologies.includes(techName)) {
            selectedTechnologies.push(techName);
        }
    });
    
    updateSelectedTechsDisplay();
    updateTechnologiesInput();
}

function clearSelectedTechs() {
    selectedTechnologies = [];
    updateSelectedTechsDisplay();
    updateTechnologiesInput();
}

function removeTech(techName) {
    selectedTechnologies = selectedTechnologies.filter(tech => tech !== techName);
    updateSelectedTechsDisplay();
    updateTechnologiesInput();
}

function updateSelectedTechsDisplay() {
    const container = document.getElementById('selected-techs');
    
    if (selectedTechnologies.length === 0) {
        container.innerHTML = '<small >No technologies selected</small>';
        return;
    }
    
    container.innerHTML = selectedTechnologies.map(tech => `
        <span class="badge bg-primary me-1 mb-1" style="font-size: 0.8rem;">
            Tsh {tech}
            <button type="button" class="btn-close btn-close-white" style="font-size: 0.6rem; margin-left: 0.3rem;" onclick="removeTech('Tsh {tech}')"></button>
        </span>
    `).join('');
}

function updateTechnologiesInput() {
    const input = document.getElementById('technologies');
    input.value = selectedTechnologies.join(', ');
}

// Update selected members count
document.addEventListener('DOMContentLoaded', function() {
    const teamSelect = document.getElementById('team_members');
    const countDiv = document.getElementById('selected-count');
    const countText = document.getElementById('count-text');
    
    function updateCount() {
        const selectedCount = teamSelect.selectedOptions.length;
        countText.textContent = selectedCount;
        
        if (selectedCount > 0) {
            countDiv.style.display = 'block';
        } else {
            countDiv.style.display = 'none';
        }
    }
    
    // Initial count
    updateCount();
    
    // Update count on change
    teamSelect.addEventListener('change', updateCount);
    
    // Initialize technology display
    updateSelectedTechsDisplay();
});
</script>
{% endblock %}
