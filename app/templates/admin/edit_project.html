{% extends "admin/admin_base.html" %}

{% block admin_title %}Edit Project{% endblock %}
{% block page_title %}Edit Project{% endblock %}
{% block breadcrumb %}<span class="breadcrumb-separator">/</span> <a href="{{ url_for('admin.projects') }}">Projects Management</a><span class="breadcrumb-separator">/</span> <span>Edit Project</span>{% endblock %}

{% block admin_content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="admin-form">
            <div class="d-flex align-items-center mb-4">
                <div class="admin-activity-icon primary me-3">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <div>
                    <h2 class="mb-1">Edit Project</h2>
                    <p class="mb-0">Update the project details</p>
                </div>
            </div>
            
            <form method="POST">
                <div class="admin-form-group">
                    <label for="title" class="admin-form-label">Project Title</label>
                    <input type="text" class="admin-form-control" id="title" name="title" 
                           value="{{ project.title }}" required>
                </div>
                
                <div class="admin-form-group">
                    <label for="description" class="admin-form-label">Project Description</label>
                    <textarea class="admin-form-control" id="description" name="description" rows="5">{{ project.description or '' }}</textarea>
                </div>
                
                <div class="admin-form-group">
                    <label for="image" class="admin-form-label">Project Image URL</label>
                    <input type="url" class="admin-form-control" id="image" name="image" 
                           value="{{ project.image or '' }}"
                           placeholder="https://example.com/project-image.jpg">
                    <small class="form-text">Optional: URL to project screenshot or logo</small>
                </div>
                
                <div class="admin-form-group">
                    <label for="technologies" class="admin-form-label">Technologies Used</label>
                    <input type="text" class="admin-form-control" id="technologies" name="technologies" 
                           value="{{ project.technologies or '' }}"
                           placeholder="e.g., Python, Flask, JavaScript, React (comma-separated)">
                </div>
                
                <div class="admin-form-group">
                    <label for="team_members" class="admin-form-label">Team Members</label>
                    <select class="admin-form-control" id="team_members" name="team_members" multiple size="5">
                        {% for member in members %}
                        <option value="{{ member.full_name }}" 
                                {% if member.full_name in project.get_team_list() %}selected{% endif %}>
                            {{ member.full_name }} - {{ member.user.email }}
                            {% if member.title %} ({{ member.title }}){% endif %}
                            {% if member.course %} - {{ member.course }}{% endif %}
                        </option>
                        {% endfor %}
                    </select>
                    <small class="form-text">Hold Ctrl/Cmd to select multiple members</small>
                    <div id="selected-count" class="text-info small mt-1" style="display: none;">
                        <i class="fas fa-users"></i> <span id="count-text">0</span> members selected
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured" 
                                   {% if project.is_featured %}checked{% endif %}>
                            <label class="form-check-label" for="is_featured">
                                Feature this project on the homepage
                            </label>
                        </div>
                        <div class="form-text">Featured projects will be displayed prominently on the main projects page</div>
                    </div>
                    {% if not members %}
                    <small >No approved members found. Members must be approved before they can be added to projects.</small>
                    {% endif %}
                </div>
                
                <div class="admin-form-group">
                    <label for="github_link" class="admin-form-label">GitHub Link</label>
                    <input type="url" class="admin-form-control" id="github_link" name="github_link" 
                           value="{{ project.github_link or '' }}"
                           placeholder="https://github.com/username/project-name">
                </div>
                
                <div class="admin-form-group">
                    <label for="demo_link" class="admin-form-label">Demo Link</label>
                    <input type="url" class="admin-form-control" id="demo_link" name="demo_link" 
                           value="{{ project.demo_link or '' }}"
                           placeholder="https://your-project-demo.com">
                </div>
                
                <div class="d-flex gap-3">
                    <button type="submit" class="admin-btn admin-btn-primary">
                        <i class="fas fa-save"></i> Update Project
                    </button>
                    <a href="{{ url_for('admin.projects') }}" class="admin-btn admin-btn-outline">
                        <i class="fas fa-arrow-left"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Update selected members count
document.addEventListener('DOMContentLoaded', function() {
    const teamSelect = document.getElementById('team_members');
    const countDiv = document.getElementById('selected-count');
    const countText = document.getElementById('count-text');
    
    function updateCount() {
        const selectedCount = teamSelect.selectedOptions.length;
        countText.textContent = selectedCount;
        
        if (selectedCount > 0) {
            countDiv.style.display = 'block';
        } else {
            countDiv.style.display = 'none';
        }
    }
    
    // Initial count
    updateCount();
    
    // Update count on change
    teamSelect.addEventListener('change', updateCount);
});
</script>
{% endblock %}
