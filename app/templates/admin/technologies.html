{% extends "admin/admin_base.html" %}

{% block admin_title %}Technology Management{% endblock %}
{% block page_title %}Technology Management{% endblock %}
{% block breadcrumb %}<span class="breadcrumb-separator">/</span> <span>Technology Management</span>{% endblock %}

{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">Technology Management</h2>
        <p class="mb-0">Manage predefined technologies for project categorization</p>
    </div>
    <a href="{{ url_for('admin.add_technology') }}" class="admin-btn admin-btn-primary">
        <i class="fas fa-plus"></i> Add Technology
    </a>
</div>

<!-- Filter Section -->
<div class="admin-card mb-4">
    <div class="admin-card-header">
        <h5><i class="fas fa-filter"></i> Filter Technologies</h5>
    </div>
    <div class="admin-card-body">
        <div class="row">
            <div class="col-md-6">
                <label for="category-filter" class="admin-form-label">Category</label>
                <select class="admin-form-control" id="category-filter" onchange="filterByCategory()">
                    <option value="">All Categories</option>
                    <option value="web" {% if current_category == 'web' %}selected{% endif %}>Web Development</option>
                    <option value="mobile" {% if current_category == 'mobile' %}selected{% endif %}>Mobile Apps</option>
                    <option value="ai" {% if current_category == 'ai' %}selected{% endif %}>AI/ML</option>
                    <option value="iot" {% if current_category == 'iot' %}selected{% endif %}>IoT</option>
                    <option value="data" {% if current_category == 'data' %}selected{% endif %}>Data Science</option>
                    <option value="other" {% if current_category == 'other' %}selected{% endif %}>Other</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="admin-form-label">Quick Actions</label>
                <div class="d-flex gap-2">
                    <button class="admin-btn admin-btn-outline" onclick="toggleAllStatus(true)">
                        <i class="fas fa-check"></i> Activate All
                    </button>
                    <button class="admin-btn admin-btn-outline" onclick="toggleAllStatus(false)">
                        <i class="fas fa-times"></i> Deactivate All
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{% if technologies %}
<div class="admin-table-container">
    <div class="admin-card-header">
        <h5><i class="fas fa-code"></i> Technologies ({{ technologies|length }})</h5>
    </div>
    <div class="admin-table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Icon</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for tech in technologies %}
                <tr>
                    <td>
                        {% if tech.icon %}
                        <i class="{{ tech.icon }}" style="font-size: 1.2rem; color: var(--admin-primary);"></i>
                        {% else %}
                        <i class="fas fa-code" style="font-size: 1.2rem; color: var(--admin-muted);"></i>
                        {% endif %}
                    </td>
                    <td>
                        <div class="fw-bold">{{ tech.name }}</div>
                    </td>
                    <td>
                        <span class="admin-badge admin-badge-primary">{{ tech.category|title }}</span>
                    </td>
                    <td>
                        <div  style="max-width: 200px;">
                            {{ tech.description[:100] }}{% if tech.description and tech.description|length > 100 %}...{% endif %}
                        </div>
                    </td>
                    <td>
                        {% if tech.is_active %}
                        <span class="admin-badge admin-badge-success">Active</span>
                        {% else %}
                        <span class="admin-badge admin-badge-secondary">Inactive</span>
                        {% endif %}
                    </td>
                    <td>
                        <small >{{ tech.created_at.strftime('%Y-%m-%d') }}</small>
                    </td>
                    <td>
                        <div class="d-flex gap-2">
                            <a href="{{ url_for('admin.edit_technology', tech_id=tech.id) }}" 
                               class="admin-btn admin-btn-sm admin-btn-outline">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="{{ url_for('admin.toggle_technology_status', tech_id=tech.id) }}" 
                               class="admin-btn admin-btn-sm {% if tech.is_active %}admin-btn-warning{% else %}admin-btn-success{% endif %}"
                               onclick="return confirm('Are you sure you want to {% if tech.is_active %}deactivate{% else %}activate{% endif %} this technology?')">
                                <i class="fas {% if tech.is_active %}fa-eye-slash{% else %}fa-eye{% endif %}"></i>
                            </a>
                            <a href="{{ url_for('admin.delete_technology', tech_id=tech.id) }}" 
                               class="admin-btn admin-btn-sm admin-btn-danger"
                               onclick="return confirm('Are you sure you want to delete this technology? This action cannot be undone.')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="admin-empty-state">
    <i class="fas fa-code"></i>
    <h5>No Technologies Yet</h5>
    <p>Start building your technology library by adding predefined technologies.</p>
    <a href="{{ url_for('admin.add_technology') }}" class="admin-btn admin-btn-primary">
        <i class="fas fa-plus"></i> Add First Technology
    </a>
</div>
{% endif %}

<!-- Technology Statistics -->
<div class="row mt-4">
    <div class="col-md-3">
        <div class="admin-card">
            <div class="admin-card-body text-center">
                <h3 class="text-primary">{{ technologies|length }}</h3>
                <p class="mb-0">Total Technologies</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="admin-card">
            <div class="admin-card-body text-center">
                <h3 class="text-success">{{ technologies|selectattr('is_active')|list|length }}</h3>
                <p class="mb-0">Active Technologies</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="admin-card">
            <div class="admin-card-body text-center">
                <h3 class="text-info">{{ technologies|groupby('category')|list|length }}</h3>
                <p class="mb-0">Categories</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="admin-card">
            <div class="admin-card-body text-center">
                <h3 class="text-warning">{{ technologies|rejectattr('is_active')|list|length }}</h3>
                <p class="mb-0">Inactive Technologies</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function filterByCategory() {
    const category = document.getElementById('category-filter').value;
    const url = new URL(window.location);
    
    if (category) {
        url.searchParams.set('category', category);
    } else {
        url.searchParams.delete('category');
    }
    
    window.location.href = url.toString();
}

function toggleAllStatus(activate) {
    const action = activate ? 'activate' : 'deactivate';
    if (confirm(`Are you sure you want to Tsh {action} all technologies?`)) {
        // This would require a bulk action endpoint
        alert('Bulk action feature coming soon!');
    }
}

// Add search functionality
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.createElement('input');
    searchInput.type = 'text';
    searchInput.className = 'admin-form-control';
    searchInput.placeholder = 'Search technologies...';
    searchInput.style.marginBottom = '1rem';
    
    const filterCard = document.querySelector('.admin-card');
    if (filterCard) {
        filterCard.querySelector('.admin-card-body').prepend(searchInput);
        
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('.admin-table tbody tr');
            
            rows.forEach(row => {
                const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                const category = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                const description = row.querySelector('td:nth-child(4)').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || category.includes(searchTerm) || description.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    }
});
</script>
{% endblock %}
